{"version":3,"sources":["px-vis-demos-annotation.es6.js"],"names":["Polymer","is","properties","currentChart","type","Object","isRadarParallel","Boolean","value","_seriesFound","String","annotationValue","Array","allCharts","dropdownSeries","dropdownDisplayValue","dropdownSelected","annotationText","_lockTooltip","_currentDataEdit","_editAction","editMode","attached","push","$","timeseries","xy","polar","radar","para","forEach","element","addEventListener","createAnnotation","bind","showAnnotation","hideAnnotation","editAnnotation","old","JSON","parse","stringify","toolbarConfig","config","customAnnotations","set","evt","fire","mouseCoords","target","modal","modalClose","tooltip","_tooltipHide","ttContent","_saveEdit","_deleteEdit","_cancelEdit","detail","data","chart","nodeName","mousePos","axis","clickTarget","parentElement","getAttribute","getDataFromPixel","closest","tooltipData","series","name","min","Number","MAX_VALUE","distance","val","Math","pow","coord","id","completeSeriesConfig","x","y","annotationMessage","annotationData","message","icon","forceTemplateRender","setPosition","dom","localTarget","newData","modalText","trim","_closeEdit","index","indexOf","splice"],"mappings":"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","file":"px-vis-demos-annotation.js","sourcesContent":["(function() {\n  Polymer({\n\n    is: 'px-vis-demos-annotation',\n\n    properties: {\n      currentChart: {\n        type: Object\n      },\n\n      isRadarParallel: {\n        type: Boolean,\n        value: false\n      },\n\n      _seriesFound: {\n        type: String\n      },\n\n      annotationValue: {\n        type: Array\n      },\n\n      allCharts: {\n        type: Array\n      },\n\n      dropdownSeries: {\n        type: Array\n      },\n\n      dropdownDisplayValue: {\n        type: String\n      },\n\n      dropdownSelected: {\n        type: String\n      },\n\n      annotationText: {\n        type: String,\n        value: ''\n      },\n\n      //whether the tooltip is locked in place for editing\n      _lockTooltip: {\n        type: Boolean,\n        value: false\n      },\n\n      //current annotation being edited\n      _currentDataEdit: {\n        type: Object\n      },\n\n      //cancel save delete\n      _editAction: {\n        type: String,\n        value: 'cancel'\n      },\n\n      editMode: {\n        type: Boolean,\n        value: false\n      }\n    },\n\n    attached: function() {\n\n      this.allCharts = [];\n      this.allCharts.push(this.$.timeseries);\n      this.allCharts.push(this.$.xy);\n      this.allCharts.push(this.$.polar);\n      this.allCharts.push(this.$.radar);\n      this.allCharts.push(this.$.para);\n\n      this.allCharts.forEach(function(element) {\n        element.addEventListener('px-vis-annotation-creation', this.createAnnotation.bind(this));\n        element.addEventListener('px-vis-annotation-enter', this.showAnnotation.bind(this));\n        element.addEventListener('px-vis-annotation-leave', this.hideAnnotation.bind(this));\n        element.addEventListener('px-vis-annotation-click', this.editAnnotation.bind(this));\n\n        //lazy copying...\n        var old = JSON.parse(JSON.stringify(element.toolbarConfig));\n        old.config.customAnnotations =\n          {\n            'tooltipLabel': 'Annotations',\n            'icon': 'px-vis:comment',\n            'cursorIcon': 'px-vis:comment',\n            'buttonGroup': 1,\n            'onClick': function () {\n              this.set('_internalShowTooltip', false);\n              this.set('showStrongIcon', true);\n              this.set('interactionSpaceConfig.searchType', 'closestPoint');\n              this.set('interactionSpaceConfig.searchFor', 'point');\n            },\n            'onDeselect': function () {\n              this.set('showStrongIcon', false);\n              this.set('interactionSpaceConfig.searchFor', 'timestamp');\n            },\n            'actionConfig': {\n              'mouseout': 'resetTooltip',\n              'mousemove': 'calcTooltipData',\n              'mousedown': 'null',\n              'click': function (evt) {\n                this.fire('px-vis-event-request', { 'eventName': 'px-vis-annotation-creation', 'data': { 'mouseCoords': evt.mouseCoords, 'clickTarget': evt.target, 'chart': this } })\n              },\n              'mouseup': 'null'\n            },\n            'subConfig': {\n              'hideAnnotations': {\n                'tooltipLabel': 'Hide Annotations',\n                'icon': 'px-vis:hide',\n                'buttonGroup': 1,\n                'toggle': true,\n                'onClick': 'function(button) {this.$$(\"px-vis-annotations\").set(\"hide\", button.selected);}'\n              }\n            }\n          };\n          element.set('toolbarConfig', old);\n      }, this);\n\n      this.$.modal.addEventListener('px-modal-accepted', this.modalClose.bind(this));\n\n      this.$.tooltip.addEventListener('px-tooltip-hide', this._tooltipHide.bind(this));\n      this.$.ttContent.addEventListener('tooltip-content-save', this._saveEdit.bind(this));\n      this.$.ttContent.addEventListener('tooltip-content-delete', this._deleteEdit.bind(this));\n      this.$.ttContent.addEventListener('tooltip-content-cancel', this._cancelEdit.bind(this));\n    },\n\n    createAnnotation: function(evt) {\n\n      //store current chart for further use\n      this.currentChart = evt.detail.data.chart;\n\n      //get chart type\n      this.isRadarParallel = this.currentChart.nodeName === 'PX-VIS-PARALLEL-COORDINATES' || this.currentChart.nodeName === 'PX-VIS-RADAR';\n\n      var mousePos = evt.detail.data.mouseCoords;\n\n      //find the series available\n      if(this.isRadarParallel) {\n        //find what axis we clicked on. The click target is the interaction\n        //space on top of the axis\n        var axis = evt.detail.data.clickTarget.parentElement;\n        this.set('_seriesFound', axis.getAttribute('dimension'));\n        this.annotationValue = this.getDataFromPixel(mousePos, _seriesFound);\n      } else {\n\n        var closest = this.currentChart.tooltipData.series[0].name,\n            min = Number.MAX_VALUE,\n            distance;\n\n        //we search for the closest point\n        this.currentChart.tooltipData.series.forEach(function(val) {\n\n          //do square distance because we only care about comparing\n          distance = Math.pow(val.coord[0] - mousePos[0], 2) + Math.pow(val.coord[1] - mousePos[1], 2);\n\n          if(distance < min) {\n            closest = {\n              id: val.name,\n              value: [val.value[this.currentChart.completeSeriesConfig[val.name].x], val.value[this.currentChart.completeSeriesConfig[val.name].y]]\n            };\n            min = distance;\n          }\n        }.bind(this));\n\n        this.set('_seriesFound', closest.id);\n        //here we use the value of the closest point we found. we could\n        //also use the mouse position converted to value and keep track\n        //of the closest point\n        this.annotationValue = closest.value;\n      }\n\n      //open the modal\n      this.$.modal.set('opened', true);\n    },\n\n    showAnnotation: function(evt) {\n\n      if(!this._lockTooltip) {\n\n        this.$.ttContent.annotationMessage = evt.detail.data.annotationData.data.message;\n\n        //this.$.annotationPopover.set('for', evt.detail.data.icon);\n        this.set('_ttTarget', evt.detail.data.icon);\n        this.$.tooltip.set('opened', true);\n      }\n    },\n\n    hideAnnotation: function(evt) {\n      if(!this._lockTooltip) {\n        this.$.tooltip.set('opened', false);\n      }\n    },\n\n    editAnnotation: function(evt) {\n      this._lockTooltip = true;\n\n      this.set('editMode', true);\n\n      //render our templates and repositon based on new content\n      this.$.ttContent.forceTemplateRender();\n      this.$.tooltip.setPosition();\n\n      this._currentDataEdit = evt.detail.data.annotationData;\n      this.currentChart = Polymer.dom(evt).localTarget;\n    },\n\n    modalClose: function(evt) {\n\n      //process data and assign to currentChart\n      var newData;\n\n      newData = {\n        x: this.annotationValue[0],\n        y: this.annotationValue[1],\n        data: {\n          message: this.$.modalText.value.trim()\n        },\n        series: this._seriesFound\n      };\n      this.currentChart.push('annotationData', newData);\n      this.$.modalText.value = '';\n    },\n\n    _saveEdit: function(evt) {\n      this._editAction = 'save';\n      this._closeEdit();\n    },\n\n    _cancelEdit: function(evt) {\n      this._editAction = 'cancel';\n      this._closeEdit();\n    },\n\n    _deleteEdit: function(evt) {\n      this._editAction = 'delete';\n      this._closeEdit();\n    },\n\n    _closeEdit: function() {\n      this.$.tooltip.set('opened', false);\n      this.set('editMode', false);\n      this._lockTooltip = false;\n    },\n\n    _tooltipHide: function() {\n\n      var index;\n      if(this._editAction === 'save') {\n        index = this.currentChart.annotationData.indexOf(this._currentDataEdit);\n        this.currentChart.annotationData[index].data.message = this.$.ttContent.annotationMessage;\n      } else if(this._editAction === 'delete') {\n        index = this.currentChart.annotationData.indexOf(this._currentDataEdit);\n        this.currentChart.splice('annotationData', index, 1);\n      }\n\n      this._editAction = 'none';\n    }\n  });\n})();\n"]}