'use strict';(function(){Polymer({is:'px-vis-demos-ts-split-x',properties:{chartData:{type:Object},seriesConfig:{type:Object},defaultSeriesConfig:{type:Object},splitEnabled:{type:Boolean,value:false},actionConfig:{type:Object},tooltipData:{type:Object},fakeTooltipData:{type:Object,computed:'_fakeTooltipData(tooltipData)'},splitConfig:{type:Object,value:function value(){return{'config':{'advancedZoom':true,'pan':true,'tooltip':true,'splitZoom':{'icon':'px-utl:zoom','buttonGroup':5,'tooltipLabel':'Split zoom','selectable':true,'actionConfig':{'mousedown':this.splitZoomStart.bind(this),'mouseup':this.splitZoomEnd.bind(this),'mousemove':this.splitZoomMove.bind(this)}}}}}},dismissConfig:{type:Object,value:function value(){return{'config':{'advancedZoom':true,'pan':true,'tooltip':true,'dismiss':{'icon':'px-nav:close','tooltipLabel':'close split zoom view','onClick':this.closeSplitZoom.bind(this)}}}}},zoomState:{type:Object,value:function value(){return{'isZooming':false,'domains':[],'domainsIndex':-1}}},rects:{type:Array,value:function value(){return[]}},oldExtents:{type:Object}},attached:function attached(){this.$.main.set('toolbarConfig',this.splitConfig)},_checkThemeVariable:function _checkThemeVariable(varName,defaultValue){var themeVar=this.getComputedStyleValue(varName);return!themeVar||themeVar.length===0?defaultValue:themeVar},splitZoomStart:function splitZoomStart(evt){this.zoomState.isZooming=true;this.zoomState.domains.push([this.$.main.x.invert(evt.mouseCoords[0])]);this.zoomState.domainsIndex++;Px.d3.select(document).on('mouseup.action',this.splitZoomEnd.bind(this));var startX=evt.mouseCoords[0],startY=0;this.rects.push(this.$.main.svgLower.append('rect').attr('class','action-area').attr('x',startX).attr('y',startY).attr('ox',startX).attr('rx',2).attr('width',0).attr('height',evt.target.getAttribute('height')).attr('fill',this._checkThemeVariable('--px-vis-zoom-brush-fill-color','rgb(0,0,0)')).attr('fill-opacity',this._checkThemeVariable('--px-vis-zoom-brush-fill-opacity',0.5)).attr('stroke',this._checkThemeVariable('--px-vis-zoom-brush-outline-color','rgb(0,0,0)')))},splitZoomEnd:function splitZoomEnd(evt){this.zoomState.isZooming=false;Px.d3.select(document).on('mouseup.action',null);if(this.zoomState.domains[this.zoomState.domains.length-1]){this.zoomState.domains[this.zoomState.domains.length-1].sort(function(a,b){return a-b})}if(this.zoomState.domains.length===2){this.applySplitZoom();for(var i=0;i<this.rects.length;i++){if(this.rects[i]&&this.rects[i].remove){this.rects[i].remove()}}this.rects=[]}},splitZoomMove:function splitZoomMove(evt){if(this.zoomState.isZooming){var ox=parseInt(this.rects[this.zoomState.domainsIndex].attr('ox')),newX=Math.max(Math.min(evt.mouseCoords[0],1000),0);if(newX>=ox){this.rects[this.zoomState.domainsIndex].attr('x',ox);this.rects[this.zoomState.domainsIndex].attr('width',newX-ox)}else{this.rects[this.zoomState.domainsIndex].attr('x',newX);this.rects[this.zoomState.domainsIndex].attr('width',ox-newX)}this.zoomState.domains[this.zoomState.domains.length-1][1]=this.$.main.x.invert(evt.mouseCoords[0])}},closeSplitZoom:function closeSplitZoom(evt){this.$.main.classList.remove('half');this.set('splitEnabled',false);this.$.main.set('toolbarConfig',this.splitConfig);this.$.main.set('hideRegister',false);this.$.main.set('chartExtents',{x:this.oldExtents});this.zoomState={'isZooming':false,'domains':[],'domainsIndex':-1};var oldDebounceTiming=this.$.main.debounceResizeTiming;this.$.main.debounceResizeTiming=0;this.$.main.notifyResize();this.$.main.debounceResizeTiming=oldDebounceTiming},applySplitZoom:function applySplitZoom(){this.splitZooming=false;console.log('stop split');this.set('splitEnabled',true);this.$.main.classList.add('half');if(!this.$.sub){this.$.subIf.render();this.$.sub=this.$$('#sub')}if(this.zoomState.domains[0][0]>this.zoomState.domains[1][0]){var tmp=this.zoomState.domains.shift();this.zoomState.domains.push(tmp)}this.oldExtents=this.$.main.x.domain();this.$.main.set('chartExtents',{x:this.zoomState.domains[0]});this.$.sub.set('chartExtents',{x:this.zoomState.domains[1]});this.$.main.set('toolbarConfig',this.dismissConfig);this.$.main.set('hideRegister',true);this.$.main.debounceResizeTiming=0;this.$.sub.debounceResizeTiming=0;this.$.main.notifyResize();this.$.sub.notifyResize();this.$.main.debounceResizeTiming=250;this.$.sub.debounceResizeTiming=250},_getMainClass:function _getMainClass(splitEnabled){return splitEnabled?'flex__item half':'flex__item full'},_fakeTooltipData:function _fakeTooltipData(tooltipData){var result={series:[]};for(var i=0;i<tooltipData.series.length;i++){result.series.push({'name':tooltipData.series[i].name,'value':tooltipData.series[i].value,'coord':[-999,-999]})}result.time=tooltipData.time;return result}})})();
//# sourceMappingURL=px-vis-demos-ts-split-x.js.map
