{"version":3,"sources":["px-vis-demos-ts-split-x.es6.js"],"names":["Polymer","is","properties","chartData","type","Object","seriesConfig","defaultSeriesConfig","splitEnabled","Boolean","value","actionConfig","tooltipData","fakeTooltipData","computed","splitConfig","splitZoomStart","bind","splitZoomEnd","splitZoomMove","dismissConfig","closeSplitZoom","zoomState","rects","Array","oldExtents","attached","$","main","set","_checkThemeVariable","varName","defaultValue","themeVar","getComputedStyleValue","length","evt","isZooming","domains","push","x","invert","mouseCoords","domainsIndex","Px","d3","select","document","on","startX","startY","svgLower","append","attr","target","getAttribute","sort","a","b","applySplitZoom","i","remove","ox","parseInt","newX","Math","max","min","classList","oldDebounceTiming","debounceResizeTiming","notifyResize","splitZooming","console","log","add","sub","subIf","render","$$","tmp","shift","domain","_getMainClass","_fakeTooltipData","result","series","name","time"],"mappings":"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","file":"px-vis-demos-ts-split-x.js","sourcesContent":["(function() {\n  Polymer({\n\n    is: 'px-vis-demos-ts-split-x',\n\n    properties: {\n      chartData:{\n        type: Object\n      },\n\n      seriesConfig: {\n        type: Object\n      },\n\n      defaultSeriesConfig: {\n        type: Object\n      },\n\n      splitEnabled: {\n        type: Boolean,\n        value: false\n      },\n\n      actionConfig: {\n        type: Object\n      },\n\n      tooltipData: {\n        type: Object\n      },\n\n      fakeTooltipData: {\n        type: Object,\n        computed: '_fakeTooltipData(tooltipData)'\n      },\n\n      splitConfig: {\n        type: Object,\n        value: function() {\n          return {\n            'config': {\n              'advancedZoom': true,\n              'pan': true,\n              'tooltip': true,\n              'splitZoom': {\n                'icon': 'px-utl:zoom',\n                'buttonGroup': 5,\n                'tooltipLabel': 'Split zoom',\n                'selectable': true,\n                'actionConfig': {\n                  'mousedown': this.splitZoomStart.bind(this),\n                  'mouseup': this.splitZoomEnd.bind(this),\n                  'mousemove': this.splitZoomMove.bind(this)\n                }\n              }\n            }\n          };\n        }\n      },\n\n      dismissConfig: {\n        type: Object,\n        value: function() {\n          return {\n            'config': {\n              'advancedZoom': true,\n              'pan': true,\n              'tooltip': true,\n              'dismiss': {\n                'icon': 'px-nav:close',\n                'tooltipLabel': 'close split zoom view',\n                'onClick': this.closeSplitZoom.bind(this)\n              }\n            }\n          };\n        }\n      },\n\n      zoomState: {\n        type: Object,\n        value: function() {\n          return {\n            'isZooming': false,\n            'domains': [],\n            'domainsIndex': -1\n          };\n        }\n      },\n\n      rects: {\n        type: Array,\n        value: function() {\n          return [];\n        }\n      },\n\n      oldExtents: {\n        type: Object\n      }\n    },\n\n    attached: function() {\n      this.$.main.set('toolbarConfig', this.splitConfig);\n    },\n\n    /**\n     * Checks if a theme variable exists, if so, returns the theme value, if not, returns the default\n     */\n    _checkThemeVariable: function(varName, defaultValue) {\n      var themeVar = this.getComputedStyleValue(varName);\n      return (!themeVar || themeVar.length === 0) ? defaultValue : themeVar;\n    },\n\n    splitZoomStart: function(evt) {\n\n      //store start time for this zoom\n      this.zoomState.isZooming = true;\n      this.zoomState.domains.push([this.$.main.x.invert(evt.mouseCoords[0])]);\n      this.zoomState.domainsIndex++;\n\n      //start drawing box\n\n      //in case the user clicks inside the chart, and mouses out, we are waiting for a mouseup, and closing our action box with the coordinates available on the mouseup.\n      Px.d3.select(document).on('mouseup.action', this.splitZoomEnd.bind(this));\n\n      var startX = evt.mouseCoords[0],\n          startY = 0;\n\n      //appends to the chart svg\n      this.rects.push(this.$.main.svgLower.append('rect')\n        .attr('class', 'action-area')\n        .attr('x', startX)\n        .attr('y', startY)\n        .attr('ox', startX) // save this original position for calcs\n        .attr('rx', 2)\n        .attr('width', 0)\n        .attr('height', evt.target.getAttribute('height'))\n        .attr('fill', this._checkThemeVariable('--px-vis-zoom-brush-fill-color', 'rgb(0,0,0)'))\n        .attr('fill-opacity', this._checkThemeVariable('--px-vis-zoom-brush-fill-opacity', 0.5))\n        .attr('stroke', this._checkThemeVariable('--px-vis-zoom-brush-outline-color', 'rgb(0,0,0)')));\n    },\n\n    splitZoomEnd: function(evt) {\n\n      this.zoomState.isZooming = false;\n\n      //since we are done drawing our action box, remove the listener from document using d3.\n      Px.d3.select(document).on('mouseup.action', null);\n\n      //sort start/end date\n      if(this.zoomState.domains[this.zoomState.domains.length-1]) {\n        this.zoomState.domains[this.zoomState.domains.length-1].sort(function(a, b) { return a - b;});\n      }\n\n      if (this.zoomState.domains.length === 2) {\n        this.applySplitZoom();\n\n        //clear rectangles\n        for(var i=0; i<this.rects.length; i++) {\n          if(this.rects[i] && this.rects[i].remove) {\n            this.rects[i].remove();\n          }\n        }\n        this.rects = [];\n      }\n    },\n\n    splitZoomMove: function(evt) {\n\n      if(this.zoomState.isZooming) {\n        //update drawing box\n\n        var ox = parseInt(this.rects[this.zoomState.domainsIndex].attr('ox')),\n            newX = Math.max(Math.min(evt.mouseCoords[0], 1000), 0);\n\n        // if current position is greater than the original position\n        if(newX >= ox) {\n          // set x to the original position to prevent some drift on crossover. width is equal to the difference between the x and current mouse position\n          this.rects[this.zoomState.domainsIndex].attr('x', ox);\n          this.rects[this.zoomState.domainsIndex].attr('width', newX - ox);\n        } else {\n          // else, the x is the current pos (because we cant have negative width) and width is the difference\n          this.rects[this.zoomState.domainsIndex].attr('x', newX);\n          this.rects[this.zoomState.domainsIndex].attr('width', ox - newX);\n        }\n\n        //update end time\n        this.zoomState.domains[this.zoomState.domains.length-1][1] = this.$.main.x.invert(evt.mouseCoords[0]);\n      }\n    },\n\n    closeSplitZoom: function(evt) {\n      this.$.main.classList.remove('half');\n      this.set('splitEnabled', false);\n      this.$.main.set('toolbarConfig', this.splitConfig);\n      this.$.main.set('hideRegister', false);\n      this.$.main.set('chartExtents', {x: this.oldExtents});\n      this.zoomState = {\n        'isZooming': false,\n        'domains': [],\n        'domainsIndex': -1\n      };\n      var oldDebounceTiming = this.$.main.debounceResizeTiming;\n      this.$.main.debounceResizeTiming = 0;\n      this.$.main.notifyResize();\n      this.$.main.debounceResizeTiming = oldDebounceTiming;\n    },\n\n    applySplitZoom: function() {\n\n      this.splitZooming = false;\n      console.log('stop split');\n      this.set('splitEnabled', true);\n      this.$.main.classList.add('half');\n\n      //if it hasn't been used yet force stamping and remember it\n      if(!this.$.sub) {\n        this.$.subIf.render();\n        this.$.sub = this.$$('#sub');\n      }\n\n      //ensure domains are sorted based on time\n      if(this.zoomState.domains[0][0] > this.zoomState.domains[1][0]) {\n        var tmp = this.zoomState.domains.shift();\n        this.zoomState.domains.push(tmp);\n      }\n\n      //update extents\n      this.oldExtents = this.$.main.x.domain();\n      this.$.main.set('chartExtents', {x:this.zoomState.domains[0]});\n      this.$.sub.set('chartExtents', {x:this.zoomState.domains[1]});\n\n      //cosmetic stuff\n      this.$.main.set('toolbarConfig', this.dismissConfig);\n      this.$.main.set('hideRegister', true);\n      this.$.main.debounceResizeTiming = 0;\n      this.$.sub.debounceResizeTiming = 0;\n      this.$.main.notifyResize();\n      this.$.sub.notifyResize();\n      this.$.main.debounceResizeTiming = 250;\n      this.$.sub.debounceResizeTiming = 250;\n    },\n\n    _getMainClass: function(splitEnabled) {\n      return splitEnabled ? 'flex__item half' : 'flex__item full';\n    },\n\n    _fakeTooltipData: function(tooltipData) {\n      var result = {\n        series: []\n      };\n\n      for(var i=0; i<tooltipData.series.length; i++) {\n        result.series.push({\n          'name': tooltipData.series[i].name,\n          'value': tooltipData.series[i].value,\n          'coord': [-999, -999]\n        });\n      }\n      result.time = tooltipData.time;\n\n      return result;\n    }\n  });\n})();\n"]}