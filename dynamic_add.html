<!doctype html>

<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>px-vis-timeseries Demo</title>
        <!-- Requires Webcomponents.js polyfill is provided by the page for browsers that don't support html imports -->
        <script src="../webcomponentsjs/webcomponents-lite.min.js"></script>
        <!-- Import custom element. Note: see comment about relative paths to dependencies in the *.html file referenced below -->

        <link rel="import" href="../px-theme/px-theme-styles.html">
        <!-- <link rel="import" href="../px-dark-theme/px-dark-theme-styles.html"> -->
        <style include="px-theme-styles" is="custom-style"></style>

        <link rel="import" href="px-vis-demos-dynamic-add.html"/>
        <link rel="import" href="../iron-ajax/iron-ajax.html"/>

    </head>

    <body style="padding:30px; ">
      <h1>Add charts dynamically</h1>
      <p>This page aims at helping benchmarking dynamically adding charts as well as making sure we don't introduce performance breaking changes. Look in the console for timing results for each batch of charts you've added <button id="btnPerf" style="background-color: salmon" class="btn">Click me for performance tips!</button></p>
      <ul id="tipsList" hidden>Few performance tips:
        <li>progressive rendering now can be customized through progressiveRenderingPointsPerFrame (16000 by default for lines, 2000 byy default for scatter) and progressiveRenderingMinimumFrames. Increase progressiveRenderingPointsPerFrame for better performance and decrease for smoother drawing. When at the right value no performance cost incurs and drawing is smooth but if value is too small can incur a performance cost (i.e the drawing will take longer, but will always start at the same time, also the UI won't be frozen)</li>
        <li>progressive rendering is great for big dataset, it can incur a very small performance costs for smaller one. In my opinion this is far offseted by the fact that the UI doesn't freeze</li>
        <li>scatter exacerbate perfomance issue, i.e big dataset on svg scatter can be very slow. This is <strong>always</strong> true on IE. Always use canvas rendering on IE for scatter. Preferably with progressive rendering</li>
        <li>using the navigator doesn't come cost free since this is almost a chart itself. It can double the number of points to draw. If performance is an issue consider: not displaying the navigator/using canvas rendering on the navigator/not displaying all series on the navigator by changing the navigator series config</li>
        <li>reusing charts previously created rather than dynamically creating one every time can help significantly. However this means making sure all previous properties have been appropriately changed and that something changed in order to redraw. This demo presents a really crude example of reusing charts that have been removed but doesn't deal with cleaning previous instances (hence some wrong  config and/or visual artifact can appear)</li>
        <li>TODO: prevent resize and wrapping with div</li>
        <li>TODO: close devtools</li>
        <li>TODO: IE timers are shit</li>
      </ul>
      <px-vis-demos-dynamic-add></px-vis-demos-dynamic-add>
      <script>
        window.addEventListener('WebComponentsReady', function() {
          var tipsList = document.getElementById('tipsList');

          btnPerf.addEventListener('click', function() {

            tipsList.hidden = !tipsList.hidden;
          });
        });
      </script>
    </body>
</html>
